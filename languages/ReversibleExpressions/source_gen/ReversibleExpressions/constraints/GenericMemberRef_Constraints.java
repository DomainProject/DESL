package ReversibleExpressions.constraints;

/*Generated by MPS */

import jetbrains.mps.smodel.runtime.base.BaseConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.ConstraintsDescriptorInitContext;
import jetbrains.mps.smodel.runtime.base.BaseReferenceConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.ConstraintsDescriptor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.smodel.runtime.ReferenceScopeProvider;
import jetbrains.mps.smodel.runtime.base.BaseScopeProvider;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.scope.Scope;
import jetbrains.mps.smodel.runtime.ReferenceConstraintsContext;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.core.expressions.behavior.IVariableDeclaration__BehaviorDescriptor;
import ReversibleExpressions.behavior.IVariableReference__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.core.udt.behavior.SUDeclaration__BehaviorDescriptor;
import com.mbeddr.core.udt.behavior.SUType__BehaviorDescriptor;
import jetbrains.mps.lang.scopes.runtime.NamedElementsScope;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class GenericMemberRef_Constraints extends BaseConstraintsDescriptor {
  /*package*/ GenericMemberRef_Constraints(ConstraintsDescriptorInitContext initContext) {
    super(CONCEPTS.GenericMemberRef$Ue, initContext);
    record(new RD1(this));
  }

  /*package*/ static final class RD1 extends BaseReferenceConstraintsDescriptor {
    /*package*/ RD1(ConstraintsDescriptor container) {
      super(LINKS.member$gCRV, container, true, false);
    }
    @Nullable
    @Override
    public ReferenceScopeProvider getScopeProvider() {
      return new BaseScopeProvider() {
        @Override
        public SNodeReference getSearchScopeValidatorNode() {
          return new SNodePointer("r:e81df3c1-b167-4843-95a2-4c0dd8e517e2(ReversibleExpressions.constraints)", "5718859801798778831");
        }
        @Override
        public Scope createScope(final ReferenceConstraintsContext _context) {
          final SNode enclosingNode = (((_context.getReferenceNode() == null) ? _context.getContextNode() : SNodeOperations.getParent(_context.getReferenceNode())));
          List<SNode> res = new ArrayList<SNode>();

          if (SNodeOperations.isInstanceOf(enclosingNode, CONCEPTS.GenericDotExpression$ia)) {
            SNode en = SNodeOperations.cast(enclosingNode, CONCEPTS.GenericDotExpression$ia);
            SNode ct = TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(en, LINKS.expression$HKAI));

            {
              final SNode varRef = SLinkOperations.getTarget(en, LINKS.expression$HKAI);
              if (SNodeOperations.isInstanceOf(varRef, CONCEPTS.IVariableReference$Kb)) {
                ct = IVariableDeclaration__BehaviorDescriptor.getDeclaredType_id1LDGRqyYkTX.invoke(IVariableReference__BehaviorDescriptor.getVariable_id1LDGRqyQFAf.invoke(varRef));
              }
            }
            {
              final SNode gde = SLinkOperations.getTarget(en, LINKS.expression$HKAI);
              if (SNodeOperations.isInstanceOf(gde, CONCEPTS.GenericDotExpression$ia)) {
                {
                  final SNode gmr = SLinkOperations.getTarget(gde, LINKS.target$xbCZ);
                  if (SNodeOperations.isInstanceOf(gmr, CONCEPTS.GenericMemberRef$Ue)) {
                    ct = SLinkOperations.getTarget(SLinkOperations.getTarget(gmr, LINKS.member$gCRV), LINKS.type$sXU3);
                  }
                }
              }
            }

            if (SNodeOperations.isInstanceOf(ct, CONCEPTS.SUType$qX)) {
              ListSequence.fromList(res).addSequence(ListSequence.fromList(SUDeclaration__BehaviorDescriptor.membersIncludingTransparent_id7TdHRrCpjWZ.invoke(SUType__BehaviorDescriptor.getSUDeclaration_id3bHYGwztGSo.invoke(SNodeOperations.cast(ct, CONCEPTS.SUType$qX)))));
            } else if (SNodeOperations.isInstanceOf(ct, CONCEPTS.PointerType$HX) && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(SNodeOperations.cast(ct, CONCEPTS.PointerType$HX), LINKS.baseType$zMGV), CONCEPTS.SUType$qX)) {
              ListSequence.fromList(res).addSequence(ListSequence.fromList(SUDeclaration__BehaviorDescriptor.membersIncludingTransparent_id7TdHRrCpjWZ.invoke(SUType__BehaviorDescriptor.getSUDeclaration_id3bHYGwztGSo.invoke(SNodeOperations.cast(SLinkOperations.getTarget(SNodeOperations.cast(ct, CONCEPTS.PointerType$HX), LINKS.baseType$zMGV), CONCEPTS.SUType$qX)))));
            }
          }
          return new NamedElementsScope(ListSequence.fromList(res).where((it) -> !(SPropertyOperations.getBoolean(it, PROPS.transparent$YPca))));
        }
      };
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept GenericMemberRef$Ue = MetaAdapterFactory.getConcept(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x4f5d78b09e1b9a5fL, "ReversibleExpressions.structure.GenericMemberRef");
    /*package*/ static final SConcept GenericDotExpression$ia = MetaAdapterFactory.getConcept(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x401df715da462c0cL, "ReversibleExpressions.structure.GenericDotExpression");
    /*package*/ static final SInterfaceConcept IVariableReference$Kb = MetaAdapterFactory.getInterfaceConcept(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x1c69b376a2dab98aL, "ReversibleExpressions.structure.IVariableReference");
    /*package*/ static final SConcept SUType$qX = MetaAdapterFactory.getConcept(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x32edfac823765e9dL, "com.mbeddr.core.udt.structure.SUType");
    /*package*/ static final SConcept PointerType$HX = MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x3e0cae5e366d630L, "com.mbeddr.core.pointers.structure.PointerType");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink member$gCRV = MetaAdapterFactory.getReferenceLink(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x4f5d78b09e1b9a5fL, 0x4f5d78b09f1589e9L, "member");
    /*package*/ static final SContainmentLink expression$HKAI = MetaAdapterFactory.getContainmentLink(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x29b5b7c4a3763232L, 0x64ae61a4018a9c50L, "expression");
    /*package*/ static final SContainmentLink target$xbCZ = MetaAdapterFactory.getContainmentLink(0x9abffa92487542bfL, 0x9379c4f95eb496d4L, 0x401df715da462c0cL, 0x619e8ce80b7ff48bL, "target");
    /*package*/ static final SContainmentLink type$sXU3 = MetaAdapterFactory.getContainmentLink(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x46a2a92ac61b183L, 0x46a2a92ac61b184L, "type");
    /*package*/ static final SContainmentLink baseType$zMGV = MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType");
  }

  private static final class PROPS {
    /*package*/ static final SProperty transparent$YPca = MetaAdapterFactory.getProperty(0xefda956e491e4f00L, 0xba1436af2f213ecfL, 0x7e4db776e87d75d1L, 0x6d8a8142aec9b4cdL, "transparent");
  }
}
